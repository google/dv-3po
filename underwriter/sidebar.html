<script>
  /*
    * Copyright 2021 Google Inc.
    *
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    *     http://www.apache.org/licenses/LICENSE-2.0
    *
    *     Unless required by applicable law or agreed to in writing, software
    *     distributed under the License is distributed on an "AS IS" BASIS,
    *     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    *     See the License for the specific language governing permissions and
    *     limitations under the License.
    */

/**
 * Controller functions for the sidebar UI
 */

/**
 * Sets a message to the status field in the sidebar
 */
function setStatus(status) {
  console.log(status);
  document.getElementById('status').innerHTML = status;
}

/**
 * Executes the underwriter budget and date validation
 */
function underwriter() {
  setStatus('Validating');

  new Runner().run('underwriter', [{}]).then(result => {
    setStatus('Ready');
  }).catch(error => {
    console.log(error);
    setStatus('An error happened');
  });
}

function loadReports() {
  setStatus('Loading ...');

  var job = {
    'entity': 'Reports'
  }

  new Runner().run('identifyItemsToLoad', [job]).then(jobs => {
    var loadJobs = [];

    jobs.forEach(job => loadJobs = loadJobs.concat(job.jobs));

    console.log(jobs);

    return new Runner().run('load', loadJobs);
  }).then(jobs => {
    setStatus('Ready');
  }).catch(error => {
    console.log(error);
    setStatus('An error happened');
  });

}

/**
 * Based on the data in the report tab, schedule the report triggers to pull
 * reports automatically on a daily basis
 */
function scheduleReportTriggers() {
  setStatus('Creating Triggers ...');

  var job = {
    'entity': 'Reports'
  }

  new Runner().run('scheduleReportTriggers', [job]).then(jobs => {
    setStatus('Ready');
  }).catch(error => {
    console.log(error);
    setStatus('An error happened');
  });
}

/**
 * Clears the feed
 */
function clearFeed() {
  setStatus('Clearing feed');

  new Runner().run('clear', [{
    'sheetName': 'QA',
    'range': 'A2:AZ'
  }]).then(() => setStatus('Ready'));
}

</script>
